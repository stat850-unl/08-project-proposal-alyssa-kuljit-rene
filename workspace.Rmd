---
title: "Workspace"
author: "Rene, Alyssa, Kuljit"
date: "11/19/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(skimr)
library(patchwork)
library(ggpubr)
library(sf)
library(dplyr)

health<-read.csv("Health2.csv")
foodaccess <- read.csv("FoodAccess.csv")

```

## R Markdown
Variables:
PCT_OBESE_ADULTS12-> Obesity rate in 2012
PCT_OBESE_ADULTS17-> Obesity rate in 2017
RECFACPTH16-> Rec facilities/1000 population
RECFAC16-> Count of Rec facilities in 2016
PCH_RECFAC_11_16-> %change in number of Rec facilities in 2016 from 2011.
PCTCHGOBESITY-> %Change in obesity between 2012-2017||SELF-CREATED

%%%%%%%%%%%%%%%% (code to refer)
healthdatatest %>% 
    mutate
    region = ifelse(date > as.Date("1954-03-12") & date < as.Date("1958-12-08"), "Westcoast"),
    region = ifelse(date > as.Date("1958-09-13") & date < as.Date("1964-03-08"), "Eastcoast")
  )
%%%%%%%%%%%%%%%%%% (code to refer)
healthdatatest %>%
    mutate(region= case_when(
      State="CA"~"West",
      State="DC"~"East"
    ))
%%%%%%%%%%%%%%%%%%
```{r Kuljit}
library(ggplot2)
library(skimr)
library(patchwork)
library(ggpubr)
library(reshape2)
library(dplyr)
library(tidyr)
#might use sample_n() to downscale 'healthdata'
a<-aggregate(formula = PCT_OBESE_ADULTS12 ~ State, data = health, FUN = mean)
b<-aggregate(formula = PCT_OBESE_ADULTS17 ~ State, data = health, FUN = mean)
c<-aggregate(formula = PCH_RECFAC_11_16 ~ State, data = health, FUN = mean)
d<-aggregate(formula = PCTCHG_12_17 ~ State, data = health, FUN = mean)
d<-aggregate(formula = PCTCHG_12_17 ~ State, data = health, FUN = mean)

healthdata<- data.frame(State=c$State,RECCHG=c$PCH_RECFAC_11_16,OBESE12=a$PCT_OBESE_ADULTS12, OBESE17=b$PCT_OBESE_ADULTS17,PCTCHGOBESITY=d$PCTCHG_12_17)
healthdatatest<-healthdata

#############################################
#mutate worked partially, how to add more states in one statement?
healthdatatest<-mutate(healthdatatest, region= case_when(
      State=="CA"~"West",
      State=="OR"~"West",
      State=="WA"~"West",
      State=="WV"~"East",
      State=="VA"~"East",
      State=="PA"~"East",
      State=="DC"~"East",
      State=="GA"~"East",
      State=="SC"~"East",
      State=="NC"~"East",
      State=="DC"~"East",
      State=="MD"~"East",
      State=="DE"~"East",
      State=="NJ"~"East",
      State=="NY"~"East",
      State=="CT"~"East",
      State=="RI"~"East",
      State=="MA"~"East",
      State=="ME"~"East",
      State=="FL"~"East"
    ))
eastwest<-healthdatatest
eastwest<-eastwest[complete.cases(eastwest$region),]
ew<-ggplot()+
  geom_point(data=eastwest,aes(x=region, y=RECCHG, colour="red"))+
  geom_point(data=eastwest,aes(x=region, y=PCTCHGOBESITY, colour="blue"))
ew+labs(title = "%Change in Obesity and Rec: Eastcoast V/S Westcoast", x = "Regions", y = "% Change", color = "Legend Title\n") +
  scale_color_manual(labels = c("RECCHG", "PCTCHGOBESITY"), values = c("black", "red"))

#############################################

#IDEA OF PLOTTING PCTCHGOBESITY and RECCHG on y-axis
p1<-ggplot(data=healthdata,aes(x=State,y=PCTCHGOBESITY, color=PCTCHGOBESITY ))+
  geom_point()
p2<-ggplot(data=healthdata,aes(x=State,y=RECCHG, color=RECCHG ))+
  geom_point()
p3 <- ggplot()+
  geom_point(data=healthdata,aes(x=State, y=RECCHG, colour="red"))+
  geom_point(data=healthdata,aes(x=State, y=PCTCHGOBESITY, colour="blue"))
p4<-p3+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
p4+labs(title = "%Change in Recreation facilities V/S Obesity", x = "States", y = "% Change", color = "Legend Title\n") +
  scale_color_manual(labels = c("RECCHG", "PCTCHGOBESITY"), values = c("red", "blue"))
cor(healthdata$PCTCHGOBESITY,healthdata$RECCHG, method=c("pearson", "kendall", "spearman"))


```


You can also embed plots, for example:

```{r Alyssa}

```

## Mapping Food Atlas data:

Health Data
- Mapped obesity by state
- Mapped food access by county

To Do:
- Correct color scheme so that higher % is darker color
- Overly state lines onto both maps for better identification
- identify a high and low obesity state to look at their food access closely, compare urban to rural regions
- maybe add cities? to help in identifying areas

```{r Rene}
#introduction to data
skim(health)

head(health)

summary(healthdata$PCTCHGOBESITY)
summary(health$PCT_OBESE_ADULTS12)
summary(health$PCT_OBESE_ADULTS17) #map this
# higher averages in 2017 then compared to 2012

######Creating Maps############

#SETTING UP GEOMETRY

#download shapefile for geometry of map
#zipfile from census, download and extract data
f <- tempfile()
download.file("http://www2.census.gov//geo//tiger//TIGER2020//COUNTY//tl_2020_us_county.zip", destfile = f)
unzip(f, exdir = ".")

#file added to 
us_shape <- read_sf("tl_2020_us_county.shp")

#state borders to overlay onto county data
g <- tempfile()
download.file("https://www2.census.gov//geo//tiger//TIGER2020//STATE//tl_2020_us_state.zip", destfile = g)
unzip(g, exdir = ".")

us_state <- read_sf("tl_2020_us_state.shp")

#change GEOID to int to match with FIPs for join
shape_data <- transform(us_shape, GEOID = as.numeric(GEOID))
#check it was changed
class(shape_data$GEOID)

###################
#   HEALTH DATA   #
###################

#creating a data for the obesity data we are interested in mapping
obesity_data <- data.frame(FIPS = health$Ã¯..FIPS, State = health$State, County = health$County, Pct_Obese_17 =  health$PCT_OBESE_ADULTS17)


#joining geometry to health data by FIPS and GEOID
obesity_map <- left_join(obesity_data, shape_data, by = c("FIPS" = "GEOID"))
head(obesity_map$geometry) #check data joined correctly

#ploting map of obesity
ggplot(data= obesity_map)+
  geom_sf(data= obesity_map, mapping= aes(geometry = geometry, fill = Pct_Obese_17), color = NA)+
  geom_sf(data = us_state, fill = NA, color = "black", size = 0.25)+
  coord_sf(datum= NA, xlim = c(-125, -68), ylim = c(25, 50))+
  labs(fill = "Obesity") +
  scale_fill_gradient(low= "white", high = 'blue')+
  theme_bw() +
  theme(panel.border = element_blank())+
  ggtitle("Percent of Obesity 2017")


######################
#  Food Access Data  #
######################

#interested variable: PCT_LACCESS_POP15

#creating a dataframe for food access data that we are interested in mapping
food_data <- data.frame(FIPS = foodaccess$FIPS, State = foodaccess$State, County = foodaccess$County, Pct_LowAccess_15 =  foodaccess$PCT_LACCESS_POP15)

#joining geometry to health data by FIPS and GEOID
food_map <- left_join(food_data, shape_data, by = c("FIPS" = "GEOID"))

#Plotting map of low food access

ggplot(data= food_map)+
  geom_sf(data= food_map, mapping= aes(geometry = geometry, fill = Pct_LowAccess_15), color = NA)+
  geom_sf(data = us_state, fill = NA, color = "black", size = 0.25)+
  coord_sf(datum= NA, xlim = c(-125, -68), ylim = c(25, 50))+
  labs(fill = "Low Access") +
  scale_fill_gradient(low= "white", high = 'red')+
  theme_bw() +
  theme(panel.border = element_blank())+
  ggtitle("Percent of Low Access to Food by County 2015")

########################################################
#  Mapping states to look at Urban vs. Rural


pop <- read.csv("Population.csv")
pop_data <- data.frame(FIPS = pop$FIPS, State = pop$State, County = pop$County, pop_2010 =  pop$X2010_Census_Population)

food_map2 <- left_join(food_map, pop_data, by = c("FIPS" = "FIPS"))

#Identifying the states with the highest and lowest obesity rates
health %>% slice_max(PCT_OBESE_ADULTS17) #West Virginia
health %>% slice_min(PCT_OBESE_ADULTS17) #Colorado

#West Virginia Highest Obesity
wv_map <- subset(food_map, State == "WV")
wv_state <- subset(us_state, NAME == "West Virginia")


ggplot(data= wv_map)+
  geom_sf(data= wv_map, mapping= aes(geometry = geometry, fill = Pct_LowAccess_15), color = NA)+  
  geom_sf(data = wv_state, fill = NA, color = "black", size = 0.25)+
  coord_sf(datum= NA, xlim = c(-82.76, -77.24), ylim = c(37.1, 40.49))+
  labs(fill = "Low Access") +
  scale_fill_gradient(low= "white", high = 'darkblue')+
  theme_bw() +
  theme(panel.border = element_blank())+
  ggtitle("Percent of Low Access to Food for West Virginia 2015")

#Comparison to Nebraska
ne_map <- subset(food_map, State == "NE")
ne_state <- subset(us_state, NAME == "Nebraska")

ggplot(data= ne_map)+
  geom_sf(data= ne_map, mapping= aes(geometry = geometry, fill = Pct_LowAccess_15), color = NA)+  
  geom_sf(data = ne_state, fill = NA, color = "black", size = 0.25)+
  coord_sf(datum= NA, xlim = c(-104.3, -95.3), ylim = c(39.8, 43.2))+
  labs(fill = "Low Access") +
  scale_fill_gradient(low= "white", high = 'darkblue')+
  theme_bw() +
  theme(panel.border = element_blank())+
  ggtitle("Percent of Low Access to Food for Nebraska 2015")

```

